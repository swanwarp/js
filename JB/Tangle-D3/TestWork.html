<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>D3 Test</title>
    <script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>
</head>
<body>
<script type="text/javascript">
        var w = 500;
        var h = 500;
        var barPadding = 1;

        var products = [
            "id",
            "ws",
            "cs"
        ];

        function dataConstructor(num, idea, ws, cs) {
                this.num = num
                this.pros = [idea, ws, cs];
                this.products = products;
        }

        var users = [
            new dataConstructor(0, 100, 50, 15),
            new dataConstructor(1, 50, 70, 5),
            new dataConstructor(2, 15, 5, 50)
        ];

        var svg = d3.select("body")
        .append("svg")
        .attr("width", w)
        .attr("height", h);

        function update(users, svg, getNum) {
                function retConstructor(x, y, he, wi, color, text) {
                    this.x = x;
                    this.y = y;
                    this.h = he;
                    this.w = wi;
                    this.color = color;
                    this.text = text;
                }

                var retData = [];

                for(var i = 0; i < users.length; i++) {
                    var num = 0;

                    switch(getNum) {
                        case 1: num = 1; break;
                        case 2: num = 2; break;
                        case 3: num = 3; break;
                        case -1: num = i; break;
                    }

                    console.log(num);

                    var x = i * (w / (users.length * 4));
                    var y = h - (users[i].pros[num] * 4)
                    var wi = w / (users.length * 4) - barPadding;
                    var he = users[i].pros[num] * 4;
                    var color = "rgb(255, 0, " + (users[i].pros[num]) + ")";
                    var text = users[i].pros[num] + " " + users[i].products[num]

                    retData.push(new retConstructor(
                        x,
                        y,
                        he,
                        wi,
                        color,
                        text
                    ));

                    console.log(retData[i]);
                }


                svg.selectAll("rect")
                .data(retData)
                .enter()
                .append("rect")
                .attr("x", function(d) {
                    return d.x;
                })
                .attr("y", function(d) {
                    return d.y;
                })
                .attr("width", w / (users.length * 4) - barPadding)
                .attr("height", function(d) {
                    return d.h;
                })
                .attr("fill", function(d) {
                    return d.color;
                })

                svg.selectAll("text")
                .data(retData)
                .enter()
                .append("text")
                .text(function(d) {
                    return d.text;
                })
                .attr("x", function(d, i) {
                    return d.x + 3;
                })
                .attr("y", function(d) {
                    return d.y + 15;
                })
                .attr("font-family", "sans-serif")
                .attr("font-size", "11px")
                .attr("fill", "black");


                return retData;
        }

        var info = update(users, svg, -1);
        var now = -1;

        function In(coords) {
                for(var i = 0; i < info.length; i++) {
                    if((coords[0] < (info[i].x + info[i].w)) && (coords[1] > (info[i].y))) {
                        return i;
                    }
                }

                return -1;
        }

        svg.on('click', function() {
            var coords = d3.mouse(this);
            var n = In(coords);
            if(n != -1) {
                svg.selectAll("rect").remove();
                svg.selectAll("text").remove();

                if(now != n) {
                    now = n;
                    info = update(users, svg, n);
                } else {
                    now = -1;
                    var info = update(users, svg, -1);
                }
            }
        });



        </script>
</body>
</html>