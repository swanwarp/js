<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>D3 Test</title>
    <script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>
</head>

<body>
<script type="text/javascript">
        var w = 500;
        var h = 100;
        var barPadding = 1;

        var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
                11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];


		var svg = d3.select("body")
						.append("svg")
						.attr("width", w)
						.attr("height", h);

		svg.selectAll("rect")
        .data(dataset)
        .enter()
        .append("rect")
        .attr("x", function(d, i) {
            return i * (w / dataset.length)
        })
        .attr("y", function(d) {
            return h - (d * 4);  //Height minus data value
        })
        .attr("width", w / dataset.length - barPadding)
        .attr("height", function(d) {
            return d * 4;
        })
        .attr("fill", function(d) {
            return "rgb(0, 0, " + (d * 10) + ")";
        })

        svg.selectAll("text")
        .data(dataset)
        .enter()
        .append("text")
        .text(function(d) {
            return d;
        })
        .attr("x", function(d, i) {
            return i * (w / dataset.length) + 5;
        })
        .attr("y", function(d) {
            return h - (d * 4) + 15;
        })
        .attr("font-family", "sans-serif")
        .attr("font-size", "11px")
        .attr("fill", "white");





                svg.selectAll("rect" + j)
                    .data(data[j])
                    .enter()
                    .append("rect")
                    .attr("id", j)
                    .attr("x", function(d, i) {
                        xs.push(i * (w / (data[j].length * 6)) + offset);
                        return i * (w / (data[j].length * 6)) + offset;
                    })
                    .attr("y", function(d, i) {
                        if(old_y.length == 0) {
                            return h - low*2;
                        } else {
                            return old_y[j][i];
                        }
                    })
                    .attr("width", w / (data[j].length * 6) - barPadding)
                    .attr("height", function(d, i) {
                        if(old_h.length == 0) {
                            return 0;
                        } else {
                            return old_h[j][i];
                        }
                    })
                    .attr("fill", function(d) {
                        return "rgb(255, 0, " + d + ")";
                    })
                    .on("click", function(d, i, o) {
                        u = parseInt(o[i].id);

                        switch(u) {
                            case 0: update_irp(i); break;
                            case 1: case 2: case 3: switch(i) {
                                        case 0: update_fst("IDEA", u + 2); break;
                                        case 1: update_fst("RS", u + 2); break;
                                        case 2: update_fst("PS", u + 2); break;
                                    }; break;
                        }

                        console.log(mask);
                        svg.selectAll("*").remove();
                        update(filter(mask), svg);
                    })
                    .transition()
			        .duration(400)
			        .attr("y", function(d, i) {
			            new_y[j].push(h - (d * 4) - low*2);
                        return h - (d * 4) - low*2;
                    })
			        .attr("height", function(d) {
			            new_h[j].push(d*4);
			            return d * 4;
			        });







                    svg.selectAll("rect" + j)
                    .data(data[j])
                    .enter()
                    .append("rect")
                    .attr("id", j)
                    .attr("x", 0)
                    .attr("y", function(d, i) {
                        return i * (h / (data[j].length * 10)) + offset + 30;
                    })
                    .attr("width", function(d, i) {
                        if(old_w.length != 0) {
                            return old_w[j][i];
                        }
                        return 0;
                    })
                    .attr("height", h / (data[j].length * 10) - barPadding)
                    .attr("fill", function(d) {
                        return "rgb(255, 0, " + d + ")";
                    })
                    .on("click", function(d, i, o) {
                        u = parseInt(o[i].id);

                        switch(u) {
                            case 0: update_irp(i); break;
                            case 1: case 2: case 3: switch(i) {
                                        case 0: update_fst("IDEA", u + 2); break;
                                        case 1: update_fst("RS", u + 2); break;
                                        case 2: update_fst("PS", u + 2); break;
                                    }; break;
                        }

                        console.log(mask);
                        svg.selectAll("*").remove();
                        update(filter(mask), svg);
                    }).transition()
			        .duration(400)
			        .attr("width", function(d) {
			            new_w[j].push(d*4);
			            return d * 4;
			        });








        var svg = d3.select("body")
        .append("svg")
        .attr("width", w)
        .attr("height", h);











                    svg.selectAll("text2" + j)
                    .data([0])
                    .enter()
                    .append("text")
                    .text(function() {
                        console.log(1);
                        switch(j) {
                            case 0: return "ALL";
                            case 1: return "FIRST";
                            case 2: return "SECOND";
                            case 3: return "THIRD";
                        }
                    })
                    .attr("x", xs[0])
                    .attr("y", h - low/1.5)
                    .attr("font-family", "sans-serif")
                    .attr("font-size", "16px")
                    .attr("fill", "black");

                    svg.selectAll("text" + j)
                    .data(data[j])
                    .enter()
                    .append("text")
                    .text(function(d, i) {
                        switch(i) {
                            case 0: return "idea";
                            case 1: return "rs";
                            case 2: return "ps";
                        }
                    })
                    .attr("x", function(d, i) {
                        return xs[i] + 2;
                    })
                    .attr("y", function(d) {
                        return h - low * 1.5;
                    })
                    .attr("font-family", "sans-serif")
                    .attr("font-size", "13px")
                    .attr("fill", "black");



        var y = [d3.scaleLinear().rangeRound([0, height]), d3.scaleLinear().rangeRound([0, height]), d3.scaleLinear().rangeRound([0, height])];
        var g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");
        </script>
</body>

</html>